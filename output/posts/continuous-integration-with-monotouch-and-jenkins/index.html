<!DOCTYPE html>
<html \ prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continuous Integration with MonoTouch and Jenkins | kirkg.us</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://www.kirkg.us/posts/continuous-integration-with-monotouch-and-jenkins/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Kirk Gleason">
<link rel="prev" href="../too-many-passwords/" title="Too many passwords!!!" type="text/html">
<link rel="next" href="../keeping-it-clean/" title="Keeping it clean" type="text/html">
<meta property="og:site_name" content="kirkg.us">
<meta property="og:title" content="Continuous Integration with MonoTouch and Jenkins">
<meta property="og:url" content="https://www.kirkg.us/posts/continuous-integration-with-monotouch-and-jenkins/">
<meta property="og:description" content="A couple of years ago at work we started developing a mobile application. None
of us had any mobile experience to speak of, so we read some books. As we began
debugging early versions of the app, we l">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-04-09T13:24:14-05:00">
<meta property="article:tag" content="continuous-integration">
<meta property="article:tag" content="jenkins">
<meta property="article:tag" content="monotouch">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="technology">
<meta property="article:tag" content="xamarin">
<link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
</head>
<body>

	<a href="#page-content" class="sr-only sr-only-focusable">
		Skip to main content
	</a>

	

    <section id="header"><a href="../../">
			<div class="logo">
					<div id="nologoimage">
						kirkg.us
					</div>
    		</div>
			</a>
    </section><section id="socialNav"><!-- Navigation Menu - on top on small screens, down the left on larger --><div class="navlinks">
			<a href="../../">
				<div id="titleauth">
    					kirkg.us<br> by Kirk Gleason
				</div>
			</a>

            <!-- Navigation links (hidden by default) -->
			<div id="navmenuitems">
				            <a href="../../index.html" title="Home">
                <span class="menuitemtext">Home</span>
                <span class="menuitemicon"><i class="fa fa-home"></i></span>
            </a>
            <a href="../../archive.html" title="Archives">
                <span class="menuitemtext">Archives</span>
                <span class="menuitemicon"><i class="fa fa-folder-open"></i></span>
            </a>
            <a href="../../categories/index.html" title="Tags">
                <span class="menuitemtext">Tags</span>
                <span class="menuitemicon"><i class="fa fa-tags"></i></span>
            </a>
            <a href="../../rss.xml" title="RSS">
                <span class="menuitemtext">RSS</span>
                <span class="menuitemicon"><i class="fa fa-rss"></i></span>
            </a>
            <a href="../" title="About me">
                <span class="menuitemtext">About me</span>
                <span class="menuitemicon"><i class="fa fa-user"></i></span>
            </a>
            <a href="https://www.linkedin.com/in/kirk-gleason/" title="LinkedIn">
                <span class="menuitemtext">LinkedIn</span>
                <span class="menuitemicon"><i class="fab fa-linkedin"></i></span>
            </a>
            <a href="https://github.com/kgleason" title="Github">
                <span class="menuitemtext">Github</span>
                <span class="menuitemicon"><i class="fab fa-github"></i></span>
            </a>
            <a href="https://www.gitlab.com/kgleason" title="GitLab">
                <span class="menuitemtext">GitLab</span>
                <span class="menuitemicon"><i class="fab fa-gitlab"></i></span>
            </a>
    
    

			</div>

            <!-- "Hamburger menu" / "Bar icon" to toggle the navigation links -->
			<a href="javascript:void(0);" id="hamburger" class="icon" onclick="toggleNav()">
				<i class="fa fa-bars">
				</i>
			</a>
		</div>

	</section><section class="page-content"><div class="content" rel="main">
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Continuous Integration with MonoTouch and Jenkins</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2013-04-09T13:24:14-05:00" itemprop="datePublished" title="2013-04-09 13:24">2013-04-09 13:24</time></a></p>

                <p class="commentline"><i class="far fa-comment"></i>        <a href="#disqus_thread" data-disqus-identifier="cache/posts/continuous-integration-with-monotouch-and-jenkins.html">Comments</a>


                    </p>
<p class="sourceline"><a href="index.rst" class="sourcelink"><i class="fa fa-file-code"></i> Source</a></p>

            
                <div class="tags">
<h3 class="metadata-title">
<i class="fa fa-tags"></i> Tags:</h3>
        <ul itemprop="keywords" class="tags-ul">
<li><a class="tag p-category" href="../../categories/continuous-integration/" rel="tag">continuous-integration</a></li>
            <li><a class="tag p-category" href="../../categories/jenkins/" rel="tag">jenkins</a></li>
            <li><a class="tag p-category" href="../../categories/monotouch/" rel="tag">monotouch</a></li>
            <li><a class="tag p-category" href="../../categories/programming/" rel="tag">programming</a></li>
            <li><a class="tag p-category" href="../../categories/technology/" rel="tag">technology</a></li>
            <li><a class="tag p-category" href="../../categories/xamarin/" rel="tag">xamarin</a></li>
        </ul>
</div>

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>A couple of years ago at work we started developing a mobile application. None
of us had any mobile experience to speak of, so we read some books. As we began
debugging early versions of the app, we learned pretty quickly that we needed a
standardized build process.</p>
<p>At the time we knew of solutions like Jenkins, but didn't really know where to
begin. Since the developers were pretty swamped with development and debugging,
I took on the responsibility of trying to standardize the build process. I'm not
really a programmer, and I didn't really know how solution and project files work.
Since we were working in MonoDevelop rather than in Visual Studio, none of the
devs really had time or capacity to stop and take a look at the options that
were there.</p>
<!-- TEASER_END -->
<p>For a couple of months, I was the one who made all of the builds, manually. It
was a pretty tedious process: checkout, open in MonoDevelop, set options, build,
create the IPA package manually, push to the deployment server, edit the options
in the server side plist file, and reset. I got sick of that pretty quickly. So
I started writing a bash script that would handle it all for me.</p>
<p>Part of my frustration that I have had up until recently (and even still now
somewhat) stems from the Apple provisioning process. The app that we were
developing was never intended for the app store. We develop apps for corporate
customers, which means that all of our distribution is done via what Apple calls
"In house enterprise distribution." This means that for each customer we have, we
need to sign the code with their code signing key and provisioning profile. Since
provisioning profiles are related to application ID, the application ID needs to
change for each customer. This allows us to install multiple builds of the app
on a single iPad so that we can test for each customer.</p>
<p>Fast forward 2 years, and an oft-updated version of that script still exists. As
it stands right now, here is the high level of what this script does:</p>
<ul class="simple">
<li><p>Process the 6 possible command line options</p></li>
<li><p>Set the 25 various variables this script has evolved to use.</p></li>
<li><p>Begin a loop for each of our customers</p></li>
<li><p>Begin another loop for each of our potential build environments (dev, staging, training, demo, production)</p></li>
<li><p>Use <code class="docutils literal">awk</code> &amp; <code class="docutils literal">sed</code> to make changes (8 of them) to the csproj file.</p></li>
<li><p>Use <code class="docutils literal">echo | cat &gt; Info.plist &lt;&lt; ENDEND</code> to do some variable substitution on an Info.plist template that is embedded in the script.</p></li>
<li><p><code class="docutils literal">awk</code> a change in the solution file</p></li>
<li><p>call <code class="docutils literal">mdtool</code> with the appropriate parameters</p></li>
<li><p>end the environments loop</p></li>
<li><p>end the customers loop</p></li>
</ul>
<p>This script has served us pretty well for the last 2 years, but we've found that
this sort of solution is extremely fragile. As an example,  here is a line from
the step where I make changes to the csproj file.</p>
<div class="code"><pre class="code bash"><a id="rest_code_fb795133c7af4d0d8e3f0fcca0a56b17-1" name="rest_code_fb795133c7af4d0d8e3f0fcca0a56b17-1" href="#rest_code_fb795133c7af4d0d8e3f0fcca0a56b17-1"></a><span class="c1"># Put our version number into the software</span>
<a id="rest_code_fb795133c7af4d0d8e3f0fcca0a56b17-2" name="rest_code_fb795133c7af4d0d8e3f0fcca0a56b17-2" href="#rest_code_fb795133c7af4d0d8e3f0fcca0a56b17-2"></a>awk<span class="w"> </span><span class="s2">"/\&lt;(Release|Bundle)Version\&gt;/ {sub(/201[1-9][0-9]{4}[a-z]/, "</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">")} {print}"</span><span class="w"> </span>/tmp/csproj1<span class="w"> </span>&gt;<span class="w"> </span>/tmp/csproj2
</pre></div>
<p>That command, in case you aren't familiar with awk or regex, will search the file
named <code class="docutils literal">/tmp/csproj1</code> for a pattern that essentially is designed to match '20120626b'
and then replace it with my ${VERSION} variable. The problem is that if someone
changes the '20120626b' value with something that doesn't match the pattern, then
the app will be built with the incorrect version, and this will eventually cause
problems with the enterprise deployment. The main developers have all of these
sorts of files set to ignore in our SCM, but when someone who is helping through
a crunch else commits changes, then there is some lost time trying to track down
the problem.</p>
<p>About 2 weeks ago, I was tasked with creating a repeatable way of building an
Android version of our app. It's here that I was introduced to XBuild. When I saw
how easy it was to set up a MonDroid project to build via Jenkins, I started
thinking that there had to be an easier way. I sort of found it, and what comes
next is a description of how I have things set up right now.</p>
<p>My ultimate goal here is to find a way to do all of this without all of the shell
manipulations, and to be able to set up a matrix job in Jenkins to make all of our
production builds. I'm close, but still not there yet, as you can see below.</p>
<p>I started by moving all of the private &amp; public keys, and the signed certs from
Apple into a their own keychain with a password that I don't mind having exposed
in a shell script. Then in my release configuration for the MonoTouch project, I
added a custom pre-build command. The excerpt from the project files looks similar
to this:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#rest_code_8219945a860d49bab463df734c64c6db-1"><code data-line-number="1"></code></a></td>
<td class="code"><code><a id="rest_code_8219945a860d49bab463df734c64c6db-1" name="rest_code_8219945a860d49bab463df734c64c6db-1"></a><span class="nt">&lt;CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_8219945a860d49bab463df734c64c6db-2"><code data-line-number="2"></code></a></td>
<td class="code"><code><a id="rest_code_8219945a860d49bab463df734c64c6db-2" name="rest_code_8219945a860d49bab463df734c64c6db-2"></a><span class="w">  </span><span class="nt">&lt;CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_8219945a860d49bab463df734c64c6db-3"><code data-line-number="3"></code></a></td>
<td class="code"><code><a id="rest_code_8219945a860d49bab463df734c64c6db-3" name="rest_code_8219945a860d49bab463df734c64c6db-3"></a><span class="w">    </span><span class="nt">&lt;Command</span><span class="w"> </span><span class="na">type=</span><span class="s">"BeforeBuild"</span><span class="w"> </span><span class="na">command=</span><span class="s">"bash -c "</span><span class="err">security</span><span class="w"> </span><span class="err">unlock-keychain</span><span class="w"> </span><span class="err">-p</span><span class="w"> </span><span class="err">'SuperSecretPassword'</span><span class="w"> </span><span class="err">${HOME}/Library/Keychains/iPhoneStuff.keychain""</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_8219945a860d49bab463df734c64c6db-4"><code data-line-number="4"></code></a></td>
<td class="code"><code><a id="rest_code_8219945a860d49bab463df734c64c6db-4" name="rest_code_8219945a860d49bab463df734c64c6db-4"></a><span class="w">  </span><span class="nt">&lt;/CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_8219945a860d49bab463df734c64c6db-5"><code data-line-number="5"></code></a></td>
<td class="code"><code><a id="rest_code_8219945a860d49bab463df734c64c6db-5" name="rest_code_8219945a860d49bab463df734c64c6db-5"></a><span class="nt">&lt;/CustomCommands&gt;</span>
</code></td>
</tr>
</table></div>
<p>That little tidbit allows the code sign step to happen via SSH (after it has been
run at least one time from the build server to allow the keychain to be accessed).</p>
<p>Now that I can build the app via SSH, I started figuring out how to make all of
this work with Jenkins. The command from the previous build script looked like this:</p>
<div class="code"><pre class="code bash"><a id="rest_code_46cde762c3554299b0e2741a55219ddc-1" name="rest_code_46cde762c3554299b0e2741a55219ddc-1" href="#rest_code_46cde762c3554299b0e2741a55219ddc-1"></a><span class="s2">"/Applications/Xamarin\ Studio.app/Contents/MacOS/mdtool"</span><span class="w"> </span>build<span class="w"> </span>--configuration:<span class="s2">"Release|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
</pre></div>
<p>As I started digging in, I found that a lot of the manipulations that I was doing
with <cite>awk</cite> in the build script could be accomplished through a custom build
configuration. After some tweaking, I ended up with something that looks like this:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-1" name="rest_code_a565fd231974468da021771cc4e7d231-1"></a><span class="nt">&lt;PropertyGroup</span><span class="w"> </span><span class="na">Condition=</span><span class="s">" '$(Configuration)|$(Platform)' == 'ClientProduction|iPhone' "</span><span class="nt">&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-2" name="rest_code_a565fd231974468da021771cc4e7d231-2"></a><span class="nt">&lt;DebugType&gt;</span>none<span class="nt">&lt;/DebugType&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-3" name="rest_code_a565fd231974468da021771cc4e7d231-3"></a><span class="nt">&lt;Optimize&gt;</span>false<span class="nt">&lt;/Optimize&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-4" name="rest_code_a565fd231974468da021771cc4e7d231-4"></a><span class="nt">&lt;OutputPath&gt;</span>bin\iPhone\Release<span class="nt">&lt;/OutputPath&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-5" name="rest_code_a565fd231974468da021771cc4e7d231-5"></a><span class="nt">&lt;DefineConstants&gt;</span>MTOUCH<span class="nt">&lt;/DefineConstants&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-6" name="rest_code_a565fd231974468da021771cc4e7d231-6"></a><span class="nt">&lt;ErrorReport&gt;</span>prompt<span class="nt">&lt;/ErrorReport&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-7" name="rest_code_a565fd231974468da021771cc4e7d231-7"></a><span class="nt">&lt;WarningLevel&gt;</span>4<span class="nt">&lt;/WarningLevel&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-8" name="rest_code_a565fd231974468da021771cc4e7d231-8"></a><span class="nt">&lt;MtouchLink&gt;</span>None<span class="nt">&lt;/MtouchLink&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-9" name="rest_code_a565fd231974468da021771cc4e7d231-9"></a><span class="nt">&lt;MtouchI18n</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-10" name="rest_code_a565fd231974468da021771cc4e7d231-10"></a><span class="nt">&lt;MtouchArch&gt;</span>ARMv7<span class="nt">&lt;/MtouchArch&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-11" name="rest_code_a565fd231974468da021771cc4e7d231-11"></a><span class="nt">&lt;IpaPackageName&gt;</span>OurAwesomeApp-Client<span class="nt">&lt;/IpaPackageName&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-12" name="rest_code_a565fd231974468da021771cc4e7d231-12"></a><span class="nt">&lt;ConsolePause&gt;</span>false<span class="nt">&lt;/ConsolePause&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-13" name="rest_code_a565fd231974468da021771cc4e7d231-13"></a><span class="nt">&lt;CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-14" name="rest_code_a565fd231974468da021771cc4e7d231-14"></a><span class="w">  </span><span class="nt">&lt;CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-15" name="rest_code_a565fd231974468da021771cc4e7d231-15"></a><span class="w">    </span><span class="nt">&lt;Command</span><span class="w"> </span><span class="na">type=</span><span class="s">"BeforeBuild"</span><span class="w"> </span><span class="na">command=</span><span class="s">"bash -c "</span><span class="err">security</span><span class="w"> </span><span class="err">unlock-keychain</span><span class="w"> </span><span class="err">-p</span><span class="w"> </span><span class="err">'Super</span><span class="w"> </span><span class="err">Secret</span><span class="w"> </span><span class="err">Password'</span><span class="w"> </span><span class="err">${HOME}/Library/Keychains/iPhoneStuff.keychain""</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-16" name="rest_code_a565fd231974468da021771cc4e7d231-16"></a><span class="w">  </span><span class="nt">&lt;/CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-17" name="rest_code_a565fd231974468da021771cc4e7d231-17"></a><span class="nt">&lt;/CustomCommands&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-18" name="rest_code_a565fd231974468da021771cc4e7d231-18"></a><span class="nt">&lt;BuildIpa&gt;</span>true<span class="nt">&lt;/BuildIpa&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-19" name="rest_code_a565fd231974468da021771cc4e7d231-19"></a><span class="nt">&lt;CodesignKey&gt;</span>iPhone<span class="w"> </span>Distribution:<span class="w"> </span>Enterprise<span class="w"> </span>Distribution<span class="w"> </span>Key<span class="nt">&lt;/CodesignKey&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-20"><code data-line-number="20"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-20" name="rest_code_a565fd231974468da021771cc4e7d231-20"></a><span class="nt">&lt;CodesignProvision&gt;</span>FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF<span class="nt">&lt;/CodesignProvision&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_a565fd231974468da021771cc4e7d231-21"><code data-line-number="21"></code></a></td>
<td class="code"><code><a id="rest_code_a565fd231974468da021771cc4e7d231-21" name="rest_code_a565fd231974468da021771cc4e7d231-21"></a><span class="nt">&lt;/PropertyGroup&gt;</span>
</code></td>
</tr>
</table></div>
<p>That's a huge step in the right directions, so I created a Jenkins job, and set
it up to issue these commands over SSH:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#rest_code_63ea118579cb4078bb0a2ad5cf0fbe44-1"><code data-line-number="1"></code></a></td>
<td class="code"><code><a id="rest_code_63ea118579cb4078bb0a2ad5cf0fbe44-1" name="rest_code_63ea118579cb4078bb0a2ad5cf0fbe44-1"></a>/Applications/Xamarin<span class="se">\ </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Clean<span class="w"> </span>-c:<span class="s2">"ClientProduction|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_63ea118579cb4078bb0a2ad5cf0fbe44-2"><code data-line-number="2"></code></a></td>
<td class="code"><code><a id="rest_code_63ea118579cb4078bb0a2ad5cf0fbe44-2" name="rest_code_63ea118579cb4078bb0a2ad5cf0fbe44-2"></a>/Applications/Xamarin<span class="se">\ </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Build<span class="w"> </span>-c:<span class="s2">"ClientProduction|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
</code></td>
</tr>
</table></div>
<p>Seemed like good things were about to happen. But I started right out with an
error about the AppID not matching the Provisioning Profile, and the job ended
with failure. So I needed to find a way to change the AppID on the fly.
Unfortunately, the AppID is not in the Project or Solution file, but in
Info.plist, which doesn't change based on build type. So back to the shell. <em>sigh</em></p>
<p>At this point there were a couple of different options about how to move forward.
In the end, I made a copy of Info.plist and named it Info.plist.Client. Since
Jenkins is aware of the client that it is building for, I'm able to change the
Jenkins steps to look like this:</p>
<div class="code"><pre class="code bash"><a id="rest_code_4c4010888a3d4985b75d05371d88389e-1" name="rest_code_4c4010888a3d4985b75d05371d88389e-1" href="#rest_code_4c4010888a3d4985b75d05371d88389e-1"></a>rm<span class="w"> </span>-f<span class="w"> </span>Info.plist<span class="p">;</span><span class="w"> </span>cp<span class="w"> </span>Info.plist.Client<span class="w"> </span>Info.plist
<a id="rest_code_4c4010888a3d4985b75d05371d88389e-2" name="rest_code_4c4010888a3d4985b75d05371d88389e-2" href="#rest_code_4c4010888a3d4985b75d05371d88389e-2"></a>/Applications/Xamarin<span class="se">\ </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Clean<span class="w"> </span>-c:<span class="s2">"ClientProduction|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
<a id="rest_code_4c4010888a3d4985b75d05371d88389e-3" name="rest_code_4c4010888a3d4985b75d05371d88389e-3" href="#rest_code_4c4010888a3d4985b75d05371d88389e-3"></a>/Applications/Xamarin<span class="se">\ </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Build<span class="w"> </span>-c:<span class="s2">"ClientProduction|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
</pre></div>
<p>That ended up solving a 2 different issues -- Bundle Display Name &amp; Bundle Identifier.
With everything set up this way, the build was able to succeed, but was
undeployable. As it turns out, the Version of the app is not being set anywhere,
and when using Enterprise deployment, the version number needs to be correct. Since
the version exists in both the Solution file and the csproj file, there didn't
seem to be a great way to handle this.</p>
<p>A distilled version of the original shell script seemed to be the solution. It
accepts a couple of parameters, and is now part of the project. Jenkins executes
the script before cleaning.</p>
<div class="code"><pre class="code bash"><a id="rest_code_4045d15279bd4bf09ed80aff63c0a354-1" name="rest_code_4045d15279bd4bf09ed80aff63c0a354-1" href="#rest_code_4045d15279bd4bf09ed80aff63c0a354-1"></a>rm<span class="w"> </span>-f<span class="w"> </span>Info.plist<span class="p">;</span><span class="w"> </span>cp<span class="w"> </span>Info.plist.Client<span class="w"> </span>Info.plist
<a id="rest_code_4045d15279bd4bf09ed80aff63c0a354-2" name="rest_code_4045d15279bd4bf09ed80aff63c0a354-2" href="#rest_code_4045d15279bd4bf09ed80aff63c0a354-2"></a>/bin/bash<span class="w"> </span>ShellScripts/Version_Environment_Settings.sh<span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="w"> </span>-e<span class="w"> </span>PRODUCTION
<a id="rest_code_4045d15279bd4bf09ed80aff63c0a354-3" name="rest_code_4045d15279bd4bf09ed80aff63c0a354-3" href="#rest_code_4045d15279bd4bf09ed80aff63c0a354-3"></a>/Applications/Xamarin<span class="se">\ </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Clean<span class="w"> </span>-c:<span class="s2">"ClientProduction|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
<a id="rest_code_4045d15279bd4bf09ed80aff63c0a354-4" name="rest_code_4045d15279bd4bf09ed80aff63c0a354-4" href="#rest_code_4045d15279bd4bf09ed80aff63c0a354-4"></a>/Applications/Xamarin<span class="se">\ </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Build<span class="w"> </span>-c:<span class="s2">"ClientProduction|iPhone"</span><span class="w"> </span>OurAwesomeApp.sln
</pre></div>
<p>The relevant sections of the script look like this:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-1" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-1"></a><span class="c1">##############################################################################</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-2" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-2"></a><span class="c1"># Modify the Solution (.sln) file</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-3" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-3"></a><span class="c1">##############################################################################</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-4" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-4"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-5" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-5"></a><span class="c1"># Put our version number into the software</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-6" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-6"></a>cp<span class="w"> </span>OurAwesomeApp.sln<span class="w"> </span>/tmp/sln
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-7" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-7"></a>awk<span class="w"> </span><span class="s2">"/version =/ {sub("</span>20110628b<span class="s2">", "</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">")} {print}"</span><span class="w"> </span>/tmp/sln<span class="w"> </span>&gt;<span class="w"> </span>OurAwesomeApp.sln
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-8" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-8"></a>rm<span class="w"> </span>-f<span class="w"> </span>/tmp/sln
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-9" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-9"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-10" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-10"></a><span class="c1">##############################################################################</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-11" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-11"></a><span class="c1"># Modify the csproj file</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-12" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-12"></a><span class="c1">##############################################################################</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-13" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-13"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-14" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-14"></a><span class="c1"># Put our version number into the software</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-15" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-15"></a>cp<span class="w"> </span>OurAweomseApp.csproj<span class="w"> </span>/tmp/csproj
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-16" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-16"></a>awk<span class="w"> </span><span class="s2">"/\&lt;(Release|Bundle)Version\&gt;/ {sub("</span>20110628b<span class="s2">", "</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">")} {print}"</span><span class="w"> </span>/tmp/csproj<span class="w"> </span>&gt;<span class="w"> </span>OurAwesomeApp.csproj
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-17" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-17"></a>rm<span class="w"> </span>-f<span class="w"> </span>/tmp/csproj
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-18" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-18"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_460fa78213e44dd9ab9d58d8f3858880-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><a id="rest_code_460fa78213e44dd9ab9d58d8f3858880-19" name="rest_code_460fa78213e44dd9ab9d58d8f3858880-19"></a><span class="c1"># Now we should be ready to build.</span>
</code></td>
</tr>
</table></div>
<p>With all of this in place, Jenkins will build, but some of the old problems still
exist. Namely, there is still opportunity for a commit to the Project or Solution
file to cause issues with the deployment.</p>
<p>I suspect that the reason that we have these problems is that most people are not
constantly changing their BundleIDs since when dealing with the App Store, it does
not seem to be a recommended practice.</p>
<p>I've love to hear from anyone about a better way to handle this. A link to a how-to
would be even better.</p>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../too-many-passwords/" rel="prev" title="Too many passwords!!!">Previous post</a>
            </li>
            <li class="next">
                <a href="../keeping-it-clean/" rel="next" title="Keeping it clean">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                    <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="kirkgnikolablog",
            disqus_url="https://www.kirkg.us/posts/continuous-integration-with-monotouch-and-jenkins/",
        disqus_title="Continuous Integration with MonoTouch and Jenkins",
        disqus_identifier="cache/posts/continuous-integration-with-monotouch-and-jenkins.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script>var disqus_shortname="kirkgnikolablog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>
Contents © 2026         <a href="mailto:kirk@kirkg.us">Kirk Gleason</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a><br><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png"></a>

<a title="Web Analytics" href="http://clicky.com/101017846"><img alt="Web Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0"></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script><script type="text/javascript">try{ clicky.init(101017846); }catch(e){}</script><noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101017846ns.gif"></p></noscript>

</p>
            
        </footer></article>
</div>
	</section><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>

    moment.locale("en");
    fancydates(1, "YYYY-MM-DD HH:mm");

	</script><!-- end fancy dates --><script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});

	</script><script src="../../assets/js/ToggleNav.js">
	</script>
</body>
</html>
