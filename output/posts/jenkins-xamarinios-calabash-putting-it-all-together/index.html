<!DOCTYPE html>
<html \ prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jenkins, Xamarin.iOS, &amp; Calabash -- putting it all together | kirkg.us</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://www.kirkg.us/posts/jenkins-xamarinios-calabash-putting-it-all-together/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Kirk Gleason">
<link rel="prev" href="../new-blog/" title="New Blog" type="text/html">
<link rel="next" href="../sms-shopping-list-part-1/" title="SMS Shopping List, Part 1" type="text/html">
<meta property="og:site_name" content="kirkg.us">
<meta property="og:title" content="Jenkins, Xamarin.iOS, &amp; Calabash -- putting it all together">
<meta property="og:url" content="https://www.kirkg.us/posts/jenkins-xamarinios-calabash-putting-it-all-together/">
<meta property="og:description" content="We've recently begun writing automated UI tests in Calabash  for our main
Xamarin.iOS project. While the tests are still under development, I decided to
make a Jenkins job to fire off the the UI tests">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-03-23T12:22:12-05:00">
<meta property="article:tag" content="calabash">
<meta property="article:tag" content="continuous-integration">
<meta property="article:tag" content="jenkins">
<meta property="article:tag" content="monotouch">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="technology">
<meta property="article:tag" content="xamarin">
<link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
</head>
<body>

	<a href="#page-content" class="sr-only sr-only-focusable">
		Skip to main content
	</a>

	

    <section id="header"><a href="../../">
			<div class="logo">
					<div id="nologoimage">
						kirkg.us
					</div>
    		</div>
			</a>
    </section><section id="socialNav"><!-- Navigation Menu - on top on small screens, down the left on larger --><div class="navlinks">
			<a href="../../">
				<div id="titleauth">
    					kirkg.us<br> by Kirk Gleason
				</div>
			</a>

            <!-- Navigation links (hidden by default) -->
			<div id="navmenuitems">
				            <a href="../../index.html" title="Home">
                <span class="menuitemtext">Home</span>
                <span class="menuitemicon"><i class="fa fa-home"></i></span>
            </a>
            <a href="../../archive.html" title="Archives">
                <span class="menuitemtext">Archives</span>
                <span class="menuitemicon"><i class="fa fa-folder-open"></i></span>
            </a>
            <a href="../../categories/index.html" title="Tags">
                <span class="menuitemtext">Tags</span>
                <span class="menuitemicon"><i class="fa fa-tags"></i></span>
            </a>
            <a href="../../rss.xml" title="RSS">
                <span class="menuitemtext">RSS</span>
                <span class="menuitemicon"><i class="fa fa-rss"></i></span>
            </a>
            <a href="../" title="About me">
                <span class="menuitemtext">About me</span>
                <span class="menuitemicon"><i class="fa fa-user"></i></span>
            </a>
            <a href="https://www.linkedin.com/in/kirk-gleason/" title="LinkedIn">
                <span class="menuitemtext">LinkedIn</span>
                <span class="menuitemicon"><i class="fab fa-linkedin"></i></span>
            </a>
            <a href="https://github.com/kgleason" title="Github">
                <span class="menuitemtext">Github</span>
                <span class="menuitemicon"><i class="fab fa-github"></i></span>
            </a>
            <a href="https://www.gitlab.com/kgleason" title="GitLab">
                <span class="menuitemtext">GitLab</span>
                <span class="menuitemicon"><i class="fab fa-gitlab"></i></span>
            </a>
    
    

			</div>

            <!-- "Hamburger menu" / "Bar icon" to toggle the navigation links -->
			<a href="javascript:void(0);" id="hamburger" class="icon" onclick="toggleNav()">
				<i class="fa fa-bars">
				</i>
			</a>
		</div>

	</section><section class="page-content"><div class="content" rel="main">
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Jenkins, Xamarin.iOS, &amp; Calabash -- putting it all together</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2014-03-23T12:22:12-05:00" itemprop="datePublished" title="2014-03-23 12:22">2014-03-23 12:22</time></a></p>

                    <p class="sourceline"><a href="index.rst" class="sourcelink"><i class="fa fa-file-code"></i> Source</a></p>

            
                <div class="tags">
<h3 class="metadata-title">
<i class="fa fa-tags"></i> Tags:</h3>
        <ul itemprop="keywords" class="tags-ul">
<li><a class="tag p-category" href="../../categories/calabash/" rel="tag">calabash</a></li>
            <li><a class="tag p-category" href="../../categories/continuous-integration/" rel="tag">continuous-integration</a></li>
            <li><a class="tag p-category" href="../../categories/jenkins/" rel="tag">jenkins</a></li>
            <li><a class="tag p-category" href="../../categories/monotouch/" rel="tag">monotouch</a></li>
            <li><a class="tag p-category" href="../../categories/programming/" rel="tag">programming</a></li>
            <li><a class="tag p-category" href="../../categories/technology/" rel="tag">technology</a></li>
            <li><a class="tag p-category" href="../../categories/xamarin/" rel="tag">xamarin</a></li>
        </ul>
</div>

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>We've recently begun writing automated UI tests in <a class="reference external" href="http://calaba.sh/">Calabash</a>  for our main
<a class="reference external" href="http://xamarin.com/ios">Xamarin.iOS</a> project. While the tests are still under development, I decided to
make a <a class="reference external" href="http://jenkins-ci.org/">Jenkins</a> job to fire off the the UI tests whenever a change was detected
on the branch where the tests were being developed.</p>
<p>It took a little more than I was expecting to getting it running, so it is
going to become the 2nd article in my impromptu series about Jenkins and Xamarin.</p>
<!-- TEASER_END -->
<p>Jenkins in this case, is running on a Mac Mini running the most recent version
of OS X (10.9.2) as a slave:</p>
<img alt="../../images/JenkinsSlaveConfig.png" src="../../images/JenkinsSlaveConfig.png"><p>I like this configuration because it makes it easier for me to test -- if I can
get it to run via SSH, then I can get it to run in Jenkins. In this case I think
it may have also added an additional layer of complexity, but I learned a
couple of things along the way.</p>
<p>My first step was to checkout the branch where the Calabash tests were begin
written, and run all of the build step manually in the Terminal via the UI. A
sanity check if you will. The commands looked something like this (most of these
commands are explained in a previous <a class="reference external" href="https://www.kirkg.us/2014/03/11/jenkins-xamarin-apple-enterprise/">article</a>.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-1" name="rest_code_334f7ee769854f4b87e439fb14e746cf-1"></a><span class="c1">#Unlock the keychain</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-2" name="rest_code_334f7ee769854f4b87e439fb14e746cf-2"></a>security<span class="w"> </span>unlock-keychain<span class="w"> </span>-p<span class="w"> </span><span class="se">\"</span>My<span class="w"> </span>supersecret<span class="w"> </span>keychain<span class="w"> </span>password<span class="se">\"</span><span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/Library/Keychains/login.keychain<span class="se">\"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-3" name="rest_code_334f7ee769854f4b87e439fb14e746cf-3"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-4" name="rest_code_334f7ee769854f4b87e439fb14e746cf-4"></a><span class="c1">#Set some environment variables to make it sort of like a Jenkins env</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-5" name="rest_code_334f7ee769854f4b87e439fb14e746cf-5"></a><span class="nv">WORKSPACE</span><span class="o">=</span>/Users/builder/Projects/OurAwesomeApp
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-6" name="rest_code_334f7ee769854f4b87e439fb14e746cf-6"></a><span class="nv">BUILD_NUMBER</span><span class="o">=</span><span class="m">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-7" name="rest_code_334f7ee769854f4b87e439fb14e746cf-7"></a><span class="nv">APP_VERSION</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y.<span class="k">$((</span><span class="o">((</span><span class="k">$(</span>date<span class="w"> </span>+%-m<span class="k">)</span><span class="o">-</span><span class="m">1</span><span class="o">)/</span><span class="m">3</span><span class="o">)+</span><span class="m">1</span><span class="k">))</span>.%m.<span class="si">${</span><span class="nv">BUILD_NUMBER</span><span class="si">}</span><span class="k">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-8" name="rest_code_334f7ee769854f4b87e439fb14e746cf-8"></a><span class="nv">CLIENT</span><span class="o">=</span>dev
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-9" name="rest_code_334f7ee769854f4b87e439fb14e746cf-9"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-10" name="rest_code_334f7ee769854f4b87e439fb14e746cf-10"></a><span class="c1">#Run through the Info.plist modifications</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-11" name="rest_code_334f7ee769854f4b87e439fb14e746cf-11"></a>/usr/libexec/PlistBuddy<span class="w"> </span>-c<span class="w"> </span><span class="se">\"</span>Set<span class="w"> </span>CFBundleVersion<span class="w"> </span><span class="si">${</span><span class="nv">APP_VERSION</span><span class="si">}</span><span class="se">\"</span><span class="w"> </span>Info.plist
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-12" name="rest_code_334f7ee769854f4b87e439fb14e746cf-12"></a>/usr/libexec/PlistBuddy<span class="w"> </span>-c<span class="w"> </span><span class="se">\"</span>Set<span class="w"> </span>CFBundleIdentifier<span class="w"> </span>com.ourawesomeapp.<span class="si">${</span><span class="nv">CLIENT</span><span class="si">}</span><span class="se">\"</span><span class="w"> </span>Info.plist
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-13" name="rest_code_334f7ee769854f4b87e439fb14e746cf-13"></a>/usr/libexec/PlistBuddy<span class="w"> </span>-c<span class="w"> </span><span class="se">\"</span>Set<span class="w"> </span>CFBundleURLTypes:0:CFBundleURLName<span class="w"> </span>com.ourawesomeapp.<span class="si">${</span><span class="nv">CLIENT</span><span class="si">}</span>-handler<span class="se">\"</span><span class="w"> </span>Info.plist
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-14" name="rest_code_334f7ee769854f4b87e439fb14e746cf-14"></a>/usr/libexec/PlistBuddy<span class="w"> </span>-c<span class="w"> </span><span class="se">\"</span>Set<span class="w"> </span>CFBundleURLTypes:0:CFBundleURLSchemes:0<span class="w"> </span>ourawesomeapp-<span class="si">${</span><span class="nv">CLIENT</span><span class="si">}</span><span class="se">\"</span><span class="w"> </span>Info.plist
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-15" name="rest_code_334f7ee769854f4b87e439fb14e746cf-15"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-16" name="rest_code_334f7ee769854f4b87e439fb14e746cf-16"></a><span class="c1">#Clean the solution</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-17" name="rest_code_334f7ee769854f4b87e439fb14e746cf-17"></a>/Applications/Xamarin<span class="se">\\</span><span class="w"> </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-c:<span class="se">\"</span>Debug<span class="p">|</span>iPhoneSimulator<span class="se">\"</span><span class="w"> </span>-t:Clean<span class="w"> </span>OurAwesomeApp.sln
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-18" name="rest_code_334f7ee769854f4b87e439fb14e746cf-18"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-19" name="rest_code_334f7ee769854f4b87e439fb14e746cf-19"></a><span class="c1">#Build the solution</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_334f7ee769854f4b87e439fb14e746cf-20"><code data-line-number="20"></code></a></td>
<td class="code"><code><a id="rest_code_334f7ee769854f4b87e439fb14e746cf-20" name="rest_code_334f7ee769854f4b87e439fb14e746cf-20"></a>/Applications/Xamarin<span class="se">\\</span><span class="w"> </span>Studio.app/Contents/MacOS/mdtool<span class="w"> </span>build<span class="w"> </span>-t:Build<span class="w"> </span>-c:<span class="se">\"</span>Debug<span class="p">|</span>iPhoneSimulator<span class="se">\"</span><span class="w"> </span>OurAwesomeApp.sln
</code></td>
</tr>
</table></div>
<p>The next step was to issue the <code class="docutils literal">cucumber</code> command, which ultimately failed
(after spending some time laughing at me). Turns out that building for the simulator
doesn't cause the app to get pushed to the simulator, which is what is needed for
Cucumber to execute correctly.</p>
<p>At this point, I opened the solution up in Xamarin Studio and built again, this
time with the deployment to the simulator. I kept my eye on the Build Output
screen, which ends up outputting most of the commands that are issued behind the
scenes when you tell Xamarin Studio to build. I found a command that seemed like
it would do the trick, so I copied it out into an editor, and tweaked it to make
it suit my needs.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-1" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-1"></a>/Developer/MonoTouch/usr/bin/mtouch<span class="w"> </span>-sdkroot<span class="w"> </span><span class="se">\"</span>/Applications/Xcode.app/Contents/Developer<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-2" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-2"></a>--cache<span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/obj/iPhoneSimulator/Debug/mtouch-cache<span class="se">\"</span><span class="w"> </span>--nomanifest<span class="w"> </span>--nosign<span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-3" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-3"></a>-sim<span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/bin/iPhoneSimulator/Debug/OurAwesomeApp.app<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-4" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-4"></a>-r<span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/MTSplitViewLib/MTSplitViewLib/bin/Debug/MTSplitView.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-5" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-5"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-6" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-6"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.Xml.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-7" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-7"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.Core.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-8" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-8"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.Web.Services.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-9" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-9"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.ServiceModel.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-10" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-10"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.Runtime.Serialization.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-11" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-11"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/Mono.Data.Sqlite.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-12" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-12"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/System.Data.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-13" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-13"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/monotouch.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-14" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-14"></a>-r<span class="w"> </span><span class="se">\"</span>/Developer/MonoTouch/usr/lib/mono/2.1/MonoTouch.Dialog-1.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-15" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-15"></a>-r<span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/Assemblies/FlyoutNavigation.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-16" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-16"></a>-r<span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/Components/calabash-1.5/lib/ios/Calabash.dll<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-17" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-17"></a>-debug<span class="w"> </span>-nolink<span class="w"> </span>-sdk<span class="w"> </span><span class="se">\"</span><span class="m">6</span>.1<span class="se">\"</span><span class="w"> </span>-targetver<span class="w"> </span><span class="se">\"</span><span class="m">6</span>.0<span class="se">\"</span><span class="w"> </span><span class="se">\</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#rest_code_b68d0e2fb290470e87d594cbdd9c57d4-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><a id="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-18" name="rest_code_b68d0e2fb290470e87d594cbdd9c57d4-18"></a>--abi<span class="o">=</span>i386<span class="w"> </span><span class="se">\"</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/bin/iPhoneSimulator/Debug/OurAwesomeApp.exe<span class="se">\"</span>
</code></td>
</tr>
</table></div>
<p>That's a whopper of a single command, but as I understand it from the <cite>mtouch</cite>
<a class="reference external" href="http://docs.xamarin.com/guides/ios/advanced_topics/mtouch">documentation</a>, it pretty much is just defining the build environment -- telling
mtouch explicitly where to find the SDK to build against, which assemblies to
include in the build, etc. The command that I got out of the IDE had a lot of
specific paths, and I did a find/replace job on them so that it could all be
relative to the Jenkins ${WORKSPACE}.</p>
<p>In the future I'm going to revist this command. It makes the build job brittle
in that if we remove, say, 'MTSplitView.dll' from the main solution, then this
command will break the build process. When I find a way to make it more flexible,
I'll update this post.)</p>
<p>After running that command in the Terminal, and then starting the simulator
manually, I did find the newest version of the app in my simulator. Yippee!!
Now <code class="docutils literal">cucumber</code> would run and all of the tests would run on the build server.</p>
<p>Seemed as if I was in pretty good shape, so I ssh'd into the same build server,
as the same user that I was logged in as, and ran the whole thing again.
Everything ran perfectly up to the point where cucumber started. Then it started
laughing at me again.</p>
<p>After some Googling &amp; testing, I figured out that the very first time I would
walk through my process in the UI, I would get a prompt to enter my password.
It always happened after I would execute the <code class="docutils literal">cucumber</code> command, and after the
simulator had started, but before the tests started. I didn't pay much attention
to it the first time around, and since I resolved most of the problems in the UI
in a single session, I never got prompted again.</p>
<p>My SSH session was trying to prompt, but had no UI to display the prompt on, so
it was just choking, waiting for me to authorize cucumber's request to control
the simulator. There are quite a few threads about this on the internets, but
they were all a little dated, and none of them worked quite right for me (which
is what inspired this article).</p>
<p>The first step was to make my builder account a developer:</p>
<div class="code"><pre class="code bash"><a id="rest_code_3b35ee22c6454d0780a5fd939e2a31ff-1" name="rest_code_3b35ee22c6454d0780a5fd939e2a31ff-1" href="#rest_code_3b35ee22c6454d0780a5fd939e2a31ff-1"></a>/usr/sbin/DevToolsSecurity<span class="w"> </span>-enable
</pre></div>
<p>That command is in my history for that day a couple of times. Sometimes without
the fully qualified path, and sometimes with <cite>sudo</cite>. I don't have great notes
so I don't know exactly which one did the trick, but this output let's me know
that one of them did it:</p>
<div class="code"><pre class="code bash"><a id="rest_code_53980c03202c42b9b01c339b5fce27c6-1" name="rest_code_53980c03202c42b9b01c339b5fce27c6-1" href="#rest_code_53980c03202c42b9b01c339b5fce27c6-1"></a>~$<span class="w"> </span>/usr/sbin/DevToolsSecurity
<a id="rest_code_53980c03202c42b9b01c339b5fce27c6-2" name="rest_code_53980c03202c42b9b01c339b5fce27c6-2" href="#rest_code_53980c03202c42b9b01c339b5fce27c6-2"></a>Developer<span class="w"> </span>mode<span class="w"> </span>is<span class="w"> </span>already<span class="w"> </span>enabled.
</pre></div>
<p>The next step, according to what I had managed to scrape up from Google, was to
allow the taskport privilege to be assigned without prompting.</p>
<p>Before executing this next command, I did some <a class="reference external" href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/Manpages/man8/taskgated.8.html">research</a>  <a class="reference external" href="http://www.dssw.co.uk/reference/authorization-rights/index.html">on it</a>. I encourage
you to do the same. As I understand it, the following command will allow a process
running as your user to take control of another process running as your user.
While it is exactly what we want in this case, it is generally something that is
allocated on the fly. This command will make the temporary allocation permamnent.
There is a chance that this could be used against you. Consider yourself warned.</p>
<div class="code"><pre class="code bash"><a id="rest_code_bb05255eac7f40acb0e803571efe7ebd-1" name="rest_code_bb05255eac7f40acb0e803571efe7ebd-1" href="#rest_code_bb05255eac7f40acb0e803571efe7ebd-1"></a>sudo<span class="w"> </span>security<span class="w"> </span>authorizationdb<span class="w"> </span>write<span class="w"> </span>system.privilege.taskport<span class="w"> </span>allow
</pre></div>
<p>The output from that command was encouraging:</p>
<div class="code"><pre class="code bash"><a id="rest_code_a9e6834be1f24b5386f2767923670d77-1" name="rest_code_a9e6834be1f24b5386f2767923670d77-1" href="#rest_code_a9e6834be1f24b5386f2767923670d77-1"></a>YES<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>
</pre></div>
<p>so I ran cucmber again (from SSH), and lo and behold, it worked. Needless to say,
I was very excited. I logged out, and ssh'd in again, and it worked again. Which
lead me to the conclusion that Developer mode only needed to be enabled once,
and the <cite>security authorization</cite> command did not need to be reissued everytime.</p>
<p>I added this command as my last Execute Shell in the build process in Jenkins:</p>
<div class="code"><pre class="code bash"><a id="rest_code_9933a9e6b31e478dabbf67646623588e-1" name="rest_code_9933a9e6b31e478dabbf67646623588e-1" href="#rest_code_9933a9e6b31e478dabbf67646623588e-1"></a>cucumber
</pre></div>
<p>and fired off the job. It ran without issue.</p>
<p>Next someone asked if there was a way to get a report from <code class="docutils literal">cucumber</code>, and it
turns out that there is. I modified the last step to</p>
<div class="code"><pre class="code bash"><a id="rest_code_e1bbfcc53e2b4645b1478b760f05436b-1" name="rest_code_e1bbfcc53e2b4645b1478b760f05436b-1" href="#rest_code_e1bbfcc53e2b4645b1478b760f05436b-1"></a>cucumber<span class="w"> </span>-f<span class="w"> </span>html<span class="w"> </span>-o<span class="w"> </span>CucumberResults_<span class="si">${</span><span class="nv">BUILD_ID</span><span class="si">}</span>_<span class="si">${</span><span class="nv">BUILD_NUMBER</span><span class="si">}</span>.html
</pre></div>
<p>and then used a post-build <strong>Send build artifacts over SSH</strong> to copy that html
file and all of the screen shots over to an apache server that indexes the reports:</p>
<img alt="../../images/Screen_Shot_2014_03_23_at_2_09_04_PM.png" src="../../images/Screen_Shot_2014_03_23_at_2_09_04_PM.png"><p>Pretty cool right? Clicking on one of those folders takes you right into the
report for that specific build.</p>
<p>This introduced the need to do some additional cleanup at the beginning of the
build, so I added a new <strong>Execute Shell</strong> as the first step of the build:</p>
<div class="code"><pre class="code bash"><a id="rest_code_512dc04fb6ea4a1da978dd7e8319907b-1" name="rest_code_512dc04fb6ea4a1da978dd7e8319907b-1" href="#rest_code_512dc04fb6ea4a1da978dd7e8319907b-1"></a>rm<span class="w"> </span>-f<span class="w"> </span>CucumberResults*.html<span class="w"> </span>screenshot_*.png
</pre></div>
<p>It's not very elegant, but it does get the job done.</p>
<p>I was ready for my final test, before I put this one to bed for a while. So I
fired the job, and it failed. Ugh.</p>
<p>Turns out that one of the Calabash tests had failed, which caused <code class="docutils literal">cucumber</code> to
exit with a non-zero status. This cause Jenkins to consider the build failed,
which meant that the report was not copied over, so we couldn't really see what
had happened.</p>
<p>I decided to take the easy way out. I modified the <code class="docutils literal">cucumber</code> step in Jenkins to look like this:</p>
<div class="code"><pre class="code bash"><a id="rest_code_950f4407a60149d48aad8aeb94a239f9-1" name="rest_code_950f4407a60149d48aad8aeb94a239f9-1" href="#rest_code_950f4407a60149d48aad8aeb94a239f9-1"></a>cucumber<span class="w"> </span>-f<span class="w"> </span>html<span class="w"> </span>-o<span class="w"> </span>CucumberResults_<span class="si">${</span><span class="nv">BUILD_ID</span><span class="si">}</span>_<span class="si">${</span><span class="nv">BUILD_NUMBER</span><span class="si">}</span>.html<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
</pre></div>
<p>which will cause the command to always return 0, thereby tricking Jenkins into
always thinking that <code class="docutils literal">cucumber</code> exited cleanly. There is probably a more elegant
way to solve that problem, but for the time being, it works.</p>
<p>Now as the developers are working on bugs and new features, they are able to
write the UI tests for Calabash, and submit them. For the time being, it is
still all living in a separate git branch. Jenkins is monitoring that branch,
and when changes are pushed to it, Jenkins fires off. Once it is all merged back
into master, then Jenkins will be modified -- and we will probably begin running
our UI tests nightly.</p>
<p>Of course it isn't quite as good as I want it to be yet. I still have the following
things that I need to figure out (so stay tuned, it will be showing up here as
soon as I figure it all out):</p>
<ul class="simple">
<li><p>specifying the OS version to run in the simulator. Right now, the simulator starts with whatever the last version was run. I'd like to be able to have it run on every version of the simulator that is installed &amp; that we are currently supporting (right now that is 3 versions of iOS).</p></li>
<li><p>making it run on an actual device. The first rule of app development is don't do all of your testing in the simulator. It's a good rule, and I want to follow it.</p></li>
<li><p>making it all work in Android.</p></li>
</ul>
<p>In fact I have a lot of Android work yet to do...</p>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../new-blog/" rel="prev" title="New Blog">Previous post</a>
            </li>
            <li class="next">
                <a href="../sms-shopping-list-part-1/" rel="next" title="SMS Shopping List, Part 1">Next post</a>
            </li>
        </ul></nav></aside><footer id="footer"><p>
Contents Â© 2026         <a href="mailto:kirk@kirkg.us">Kirk Gleason</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a><br><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png"></a>

<a title="Web Analytics" href="http://clicky.com/101017846"><img alt="Web Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0"></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script><script type="text/javascript">try{ clicky.init(101017846); }catch(e){}</script><noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101017846ns.gif"></p></noscript>

</p>
            
        </footer></article>
</div>
	</section><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>

    moment.locale("en");
    fancydates(1, "YYYY-MM-DD HH:mm");

	</script><!-- end fancy dates --><script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});

	</script><script src="../../assets/js/ToggleNav.js">
	</script>
</body>
</html>
